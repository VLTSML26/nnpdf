#
# New runcard for multiclosure-test reporting
# Author: Samuele Voltan
# Last updated: October 2022
# Please remember to check the following parameters
# 1) fits
# 2) new datasets (different when th 163 is used)
# 3) theory id (163 with thcovmat)
# 4) manipulate_eigenvalue and thcovmat_fraction flags
#

# reference fit
fit: thcovbase-001

# all fits
fits:
    - thcovbase-001
    - thcovbase-002
    - thcovbase-003
    - thcovbase-004
    - thcovbase-005
    - thcovbase-006
    - thcovbase-007
    - thcovbase-008
    - thcovbase-009
    - thcovbase-010
    - thcovbase-011
    - thcovbase-012
    - thcovbase-013
    - thcovbase-014
    - thcovbase-015
    - thcovbase-016
    - thcovbase-017
    - thcovbase-018
    - thcovbase-019
    - thcovbase-020
    - thcovbase-021
    - thcovbase-022
    - thcovbase-023
    - thcovbase-024
    - thcovbase-025

# pdfs declaration
t0pdfset: 220426-sv-003_fakepdf
pdfs:
    - NNPDF40_nnlo_as_01180
    - 220426-sv-003_fakepdf

# datasets for out-of-sample statistics (not included in fit runcard)
on_newdata:
    use_fitcommondata: False
    dataset_inputs:
        - {dataset: DYE906R_dw_ite, frac: 0.75, cfac: [ACC,QCD]}
        - {dataset: ATLASWZRAP11CF, frac: 0.75, cfac: [QCD]}
        - {dataset: ATLASDY2D8TEV, frac: 0.75, cfac: [QCDEWK]}
        - {dataset: ATLAS_DY_2D_8TEV_LOWMASS, cfac: [QCD]}
        - {dataset: ATLAS_WZ_TOT_13TEV, frac: 1.0, cfac: [NRM,QCD]}
        - {dataset: ATLAS_WP_JET_8TEV_PT, frac: 0.75, cfac: [QCD]}
        - {dataset: ATLAS_WM_JET_8TEV_PT, frac: 0.75, cfac: [QCD]}
        - {dataset: ATLAS_TTBARTOT_13TEV_FULLLUMI, frac: 0.75, cfac: [QCD]}
        - {dataset: ATLAS_TTB_DIFF_8TEV_LJ_TTRAPNORM, frac: 1.0, cfac: [QCD]}
        - {dataset: ATLAS_TOPDIFF_DILEPT_8TEV_TTRAPNORM, frac: 1.0, cfac: [QCD]}
        - {dataset: ATLAS_1JET_8TEV_R06_DEC, frac: 0.75, cfac: [QCD]}
        - {dataset: ATLAS_2JET_7TEV_R06, frac: 0.75, cfac: [QCD]}
        - {dataset: ATLASPHT15_SF, frac: 0.75, cfac: [QCD, EWK]}
        - {dataset: ATLAS_SINGLETOP_TCH_R_7TEV, frac: 1.0, cfac: [QCD]}
        - {dataset: ATLAS_SINGLETOP_TCH_R_13TEV, frac: 1.0, cfac: [QCD]}
        - {dataset: ATLAS_SINGLETOP_TCH_DIFF_7TEV_T_RAP_NORM, frac: 1.0, cfac: [QCD]}
        - {dataset: ATLAS_SINGLETOP_TCH_DIFF_7TEV_TBAR_RAP_NORM, frac: 1.0, cfac: [QCD]}
        - {dataset: ATLAS_SINGLETOP_TCH_DIFF_8TEV_T_RAP_NORM, frac: 0.75, cfac: [QCD]}
        - {dataset: ATLAS_SINGLETOP_TCH_DIFF_8TEV_TBAR_RAP_NORM, frac: 0.75, cfac: [QCD]}
        - {dataset: CMS_2JET_7TEV, frac: 0.75, cfac: [QCD]}
        - {dataset: CMS_1JET_8TEV, frac: 0.75, cfac: [QCD]}
        - {dataset: CMSTTBARTOT5TEV, frac: 1.0, cfac: [QCD]}
        - {dataset: CMS_TTBAR_2D_DIFF_MTT_TRAP_NORM, frac: 1.0, cfac: [QCD]}
        - {dataset: CMS_TTB_DIFF_13TEV_2016_2L_TRAP, frac: 1.0, cfac: [QCD]}
        - {dataset: CMS_TTB_DIFF_13TEV_2016_LJ_TRAP, frac: 1.0, cfac: [QCD]}
        - {dataset: CMS_SINGLETOP_TCH_TOT_7TEV, frac: 1.0, cfac: [QCD]}
        - {dataset: CMS_SINGLETOP_TCH_R_8TEV, frac: 1.0, cfac: [QCD]}
        - {dataset: CMS_SINGLETOP_TCH_R_13TEV, frac: 1.0, cfac: [QCD]}
        - {dataset: LHCB_Z_13TEV_DIMUON, frac: 1.0, cfac: [QCD]}
        - {dataset: LHCB_Z_13TEV_DIELECTRON, frac: 1.0, cfac: [QCD]}

# datasets from fit runcard
on_samedata:
    use_fitcommondata: True
    dataset_inputs:
        from_: fit

# config parameters
q2min: 3.49
w2min: 12.5
theoryid: 163 # NOTE: remember to check this
Q: 1.61
metadata_group: experiment
use_cuts: internal
use_t0: True
genrep: true
use_sameseed: False

# closuretest parameters
# TODO: find a way to parse from closuretest namespace even if there is no key
# there (set to None by default somewhere)
closuretest:
    from_: fit
fakepdf:
    from_: closuretest
thcovmat_fraction: None # for now by hand
    # from_: closuretest
manipulate_eigenvalue: None # for now by hand
    # from_: closuretest
fakenoise: 
    from_: closuretest

# plotting parameters
bases:
  - basis: evolution
  - basis: flavour

# meta
meta:
    title: Multiclosure test report
    keywords: [multiclosure, nnpdf40]
    author: Samuele Voltan

# plots and tables handled by external markdown files
plot_delta_chi2_report:
    meta: Null
    template: deltachi2.md

plot_biasvariance_report:
    meta: Null
    template: biasvariance.md

plot_xi_report:
    meta: Null
    template: xi.md

plot_replicas_report:
    meta: Null
    template: plotreplicas.md

# template markdown file
template: multiclosure_report.md

# action
actions_:
    - report(main=true)